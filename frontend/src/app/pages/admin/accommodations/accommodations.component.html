<div class="accommodations-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="title-section">
      <h1 class="page-title">
        <mat-icon class="title-icon">apartment</mat-icon>
        Szállások
      </h1>
      <p class="page-subtitle">Szállások kezelése és létrehozása</p>
    </div>
    <div class="header-actions">
      <button
        mat-stroked-button
        class="refresh-button"
        (click)="loadAccommodations()"
        [disabled]="loading"
        matTooltip="Lista frissítése">
        <mat-icon [class.spinning]="loading">refresh</mat-icon>
        <span>Frissítés</span>
      </button>
      <button
        *ngIf="userRole === 'ADMIN'"
        mat-flat-button
        color="primary"
        class="add-button"
        (click)="toggleCreateForm()">
        <mat-icon>{{ showCreateForm ? 'close' : 'add' }}</mat-icon>
        <span>{{ showCreateForm ? 'Mégse' : 'Új szállás' }}</span>
      </button>
    </div>
  </div>

  <!-- Create Form -->
  <mat-card *ngIf="showCreateForm" class="create-card">
    <mat-card-content>
      <h3 class="card-title">
        <mat-icon>{{ editMode ? 'edit' : 'add_business' }}</mat-icon>
        {{ editMode ? 'Szállás szerkesztése' : 'Új szállás hozzáadása' }}
      </h3>

      <form [formGroup]="createForm" (ngSubmit)="createAccommodation()" class="create-form">
        <div class="form-grid">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Szállás neve</mat-label>
            <input matInput formControlName="name" required>
            <mat-icon matIconPrefix>apartment</mat-icon>
            <mat-error *ngIf="createForm.get('name')?.hasError('required')">
              Kötelező mező
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Cím</mat-label>
            <input matInput formControlName="address" required>
            <mat-icon matIconPrefix>location_on</mat-icon>
            <mat-error *ngIf="createForm.get('address')?.hasError('required')">
              Kötelező mező
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Manager kapcsolat</mat-label>
            <input matInput formControlName="managerContact" required>
            <mat-icon matIconPrefix>contact_phone</mat-icon>
            <mat-error *ngIf="createForm.get('managerContact')?.hasError('required')">
              Kötelező mező
            </mat-error>
          </mat-form-field>
        </div>

        <div class="capacity-info">
          <mat-icon>info</mat-icon>
          <p>A szállás kapacitása automatikusan számolódik a hozzáadott szobák alapján</p>
        </div>

        <div class="form-actions">
          <button
            mat-flat-button
            color="primary"
            type="submit"
            class="submit-button"
            [disabled]="creating || createForm.invalid">
            <mat-spinner *ngIf="creating" diameter="20" class="button-spinner"></mat-spinner>
            <mat-icon *ngIf="!creating">{{ editMode ? 'save' : 'add' }}</mat-icon>
            <span *ngIf="!creating">{{ editMode ? 'Mentés' : 'Létrehozás' }}</span>
            <span *ngIf="creating">{{ editMode ? 'Mentés...' : 'Létrehozás...' }}</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Data Table -->
  <mat-card class="table-card">
    <mat-card-content>
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Szállások betöltése...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="error-container">
        <mat-icon>error_outline</mat-icon>
        <p>{{ error }}</p>
        <button mat-flat-button color="primary" (click)="loadAccommodations()">
          <mat-icon>refresh</mat-icon>
          Újrapróbálás
        </button>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && !error && accommodations.length === 0" class="empty-container">
        <mat-icon>apartment</mat-icon>
        <p>Még nincsenek szállások</p>
        <button
          *ngIf="userRole === 'ADMIN'"
          mat-flat-button
          color="primary"
          (click)="toggleCreateForm()">
          <mat-icon>add</mat-icon>
          Első szállás hozzáadása
        </button>
      </div>

      <!-- Table -->
      <div *ngIf="!loading && !error && accommodations.length > 0" class="table-container">
        <table mat-table [dataSource]="accommodations" class="accommodations-table">

          <!-- ID Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>ID</th>
            <td mat-cell *matCellDef="let accommodation">{{ accommodation.id }}</td>
          </ng-container>

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Név</th>
            <td mat-cell *matCellDef="let accommodation">
              <div class="name-cell">
                <mat-icon>apartment</mat-icon>
                <span class="name">{{ accommodation.name }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Address Column -->
          <ng-container matColumnDef="address">
            <th mat-header-cell *matHeaderCellDef>Cím</th>
            <td mat-cell *matCellDef="let accommodation">{{ accommodation.address }}</td>
          </ng-container>

          <!-- Manager Contact Column -->
          <ng-container matColumnDef="managerContact">
            <th mat-header-cell *matHeaderCellDef>Manager</th>
            <td mat-cell *matCellDef="let accommodation">{{ accommodation.managerContact }}</td>
          </ng-container>

          <!-- Total Capacity Column -->
          <ng-container matColumnDef="totalCapacity">
            <th mat-header-cell *matHeaderCellDef>Kapacitás</th>
            <td mat-cell *matCellDef="let accommodation">
              <span class="capacity-badge">{{ accommodation.totalCapacity }} fő</span>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Műveletek</th>
            <td mat-cell *matCellDef="let accommodation">
              <div class="action-buttons">
                <button
                  *ngIf="userRole === 'ADMIN'"
                  mat-icon-button
                  color="accent"
                  matTooltip="Szerkesztés"
                  (click)="editAccommodation(accommodation)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="primary"
                  matTooltip="Szobák kezelése"
                  (click)="viewRooms(accommodation)">
                  <mat-icon>meeting_room</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</div>

