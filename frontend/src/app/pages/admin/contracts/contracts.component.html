<!-- Contracts Dialog -->
<div class="contracts-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>
      <mat-icon>description</mat-icon>
      Szerződések - {{ data.employeeName }}
    </h2>
    <button mat-icon-button (click)="close()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="dialog-content">
    <!-- Header Actions -->
    <div class="header-actions">
      <button
        mat-stroked-button
        (click)="loadContracts()"
        [disabled]="loading">
        <mat-icon [class.spinning]="loading">refresh</mat-icon>
        Frissítés
      </button>
      <button
        mat-flat-button
        color="primary"
        (click)="openCreateDialog()">
        <mat-icon>add</mat-icon>
        Új szerződés
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Szerződések betöltése...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-container">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <p>{{ error }}</p>
      <button mat-flat-button color="primary" (click)="loadContracts()">
        <mat-icon>refresh</mat-icon>
        Újrapróbálás
      </button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && contracts.length === 0" class="empty-container">
      <mat-icon class="empty-icon">description</mat-icon>
      <h3>Nincsenek szerződések</h3>
      <p>Még nem készült szerződés ehhez az alkalmazotthoz.</p>
      <button mat-flat-button color="primary" (click)="openCreateDialog()">
        <mat-icon>add</mat-icon>
        Első szerződés létrehozása
      </button>
    </div>

    <!-- Contracts Table -->
    <div *ngIf="!loading && !error && contracts.length > 0" class="table-container">
      <table mat-table [dataSource]="contracts" class="contracts-table">

        <!-- Contract Number Column -->
        <ng-container matColumnDef="contractNumber">
          <th mat-header-cell *matHeaderCellDef>Szerződés szám</th>
          <td mat-cell *matCellDef="let contract">
            <div class="contract-number">{{ contract.contractNumber }}</div>
            <div class="contract-created">{{ formatDate(contract.createdAt) }}</div>
          </td>
        </ng-container>

        <!-- Dates Column -->
        <ng-container matColumnDef="dates">
          <th mat-header-cell *matHeaderCellDef>Időszak</th>
          <td mat-cell *matCellDef="let contract">
            <div class="dates-cell">
              <div class="date-row">
                <mat-icon>event</mat-icon>
                {{ formatDate(contract.startDate) }}
              </div>
              <div class="date-separator">→</div>
              <div class="date-row">
                <mat-icon>event</mat-icon>
                {{ formatDate(contract.endDate) }}
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Rate Column -->
        <ng-container matColumnDef="rate">
          <th mat-header-cell *matHeaderCellDef>Óradíj</th>
          <td mat-cell *matCellDef="let contract">
            <div class="rate-cell">{{ formatCurrency(contract.hourlyRate, contract.currency) }}/óra</div>
          </td>
        </ng-container>

        <!-- Working Hours Column -->
        <ng-container matColumnDef="hours">
          <th mat-header-cell *matHeaderCellDef>Heti óraszám</th>
          <td mat-cell *matCellDef="let contract">
            <div class="hours-cell">{{ contract.workingHoursPerWeek }} óra/hét</div>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Státusz</th>
          <td mat-cell *matCellDef="let contract">
            <mat-chip [class]="getStatusColor(contract.status)" class="status-chip">
              <mat-icon>{{ getStatusIcon(contract.status) }}</mat-icon>
              {{ getStatusText(contract.status) }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Műveletek</th>
          <td mat-cell *matCellDef="let contract">
            <div class="action-buttons">
              <button
                mat-icon-button
                color="primary"
                matTooltip="PDF letöltése"
                (click)="downloadPdf(contract)">
                <mat-icon>download</mat-icon>
              </button>
              <button
                *ngIf="contract.status === 'ACTIVE' || contract.status === 'DRAFT'"
                mat-icon-button
                color="warn"
                matTooltip="Szerződés lezárása"
                (click)="invalidateContract(contract, $event)">
                <mat-icon>cancel</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
      </table>
    </div>
  </mat-dialog-content>
</div>

